<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û—Ç–ª–∞–¥–∫–∞ —Å–µ—Å—Å–∏–∏</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .security-good { color: green; font-weight: bold; }
        .security-bad { color: red; font-weight: bold; }
        .session-table { width: 100%; border-collapse: collapse; }
        .session-table th, .session-table td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        .session-table tr:nth-child(even) { background-color: #f2f2f2; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 3px; overflow: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîê –û—Ç–ª–∞–¥–∫–∞ —Å–µ—Å—Å–∏–∏</h1>

        <div class="section">
            <h2>–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</h2>
            <p>
                <strong>–ü–∞—Ä–æ–ª—å –≤ —Å–µ—Å—Å–∏–∏:</strong>
                {% if password_in_session %}
                    <span class="security-bad">‚ùå –ù–ê–ô–î–ï–ù - –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –£–Ø–ó–í–ò–ú–û–°–¢–¨!</span>
                {% else %}
                    <span class="security-good">‚úÖ –ù–ï –ù–ê–ô–î–ï–ù - –•–û–†–û–®–û</span>
                {% endif %}
            </p>
            <p>
                <strong>–¢–æ–∫–µ–Ω –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:</strong>
                {% if auth_token_valid %}
                    <span class="security-good">‚úÖ –í–ê–õ–ò–î–ï–ù</span>
                {% else %}
                    <span class="security-bad">‚ùå –ù–ï–í–ê–õ–ò–î–ï–ù</span>
                {% endif %}
            </p>
            <p><strong>–ê–∫—Ç–∏–≤–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ:</strong> {{ total_tokens }}</p>
        </div>

        <div class="section">
            <h2>–°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–µ—Å—Å–∏–∏</h2>
            <table class="session-table">
                <thead>
                    <tr>
                        <th>–ö–ª—é—á</th>
                        <th>–ó–Ω–∞—á–µ–Ω–∏–µ</th>
                    </tr>
                </thead>
                <tbody>
                    {% for key, value in session_data.items() %}
                    <tr>
                        <td><code>{{ key }}</code></td>
                        <td>
                            {% if value is string and value|length > 100 %}
                                <pre>{{ value[:100] }}...</pre>
                            {% else %}
                                <pre>{{ value }}</pre>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="section">
            <h2>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</h2>
            <ul>
                <li>‚úÖ –ü–∞—Ä–æ–ª—å –ù–ï –¥–æ–ª–∂–µ–Ω —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤ —Å–µ—Å—Å–∏–∏</li>
                <li>‚úÖ –°–µ—Å—Å–∏–æ–Ω–Ω—ã–µ –∫—É–∫–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å HttpOnly</li>
                <li>‚úÖ –°–µ—Å—Å–∏–æ–Ω–Ω—ã–µ –∫—É–∫–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å Secure –≤ production</li>
                <li>‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SameSite=Lax/Strict</li>
                <li>‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Å–µ—Å—Å–∏–∏ (30 –º–∏–Ω—É—Ç)</li>
                <li>‚úÖ –•—Ä–∞–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ —Ç–æ–∫–µ–Ω—ã, –∞ –Ω–µ –ø–∞—Ä–æ–ª–∏</li>
            </ul>

            <h3>–ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞:</h3>
            <pre>
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Å—Å–∏–æ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ JavaScript
console.log("–î–æ—Å—Ç—É–ø–Ω—ã–µ cookies:", document.cookie);

// –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–ª—É—á–∏—Ç—å —Å–µ—Å—Å–∏–æ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–¥–æ–ª–∂–Ω–∞ –≤–µ—Ä–Ω—É—Ç—å –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –¥–ª—è HttpOnly)
fetch('/debug/session', { credentials: 'same-origin' })
    .then(r => r.text())
    .then(html => console.log("Session debug page loaded"));


// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –ø–∞—Ä–æ–ª—è –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞—Ö –±—Ä–∞—É–∑–µ—Ä–∞
['localStorage', 'sessionStorage'].forEach(storage => {
    for (let i = 0; i < window[storage].length; i++) {
        let key = window[storage].key(i);
        if (key.toLowerCase().includes('password')) {
            console.error(–í–ù–ò–ú–ê–ù–ò–ï: –ø–∞—Ä–æ–ª—å –Ω–∞–π–¥–µ–Ω –≤ ${storage}!);
        }
    }
});
            </pre>
        </div>

        <div class="section">
            <a href="/home">‚Üê –ù–∞–∑–∞–¥ –≤ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</a> |
            <a href="/logout">–í—ã–π—Ç–∏</a>
        </div>
    </div>
</body>
</html>